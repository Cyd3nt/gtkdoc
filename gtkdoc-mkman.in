#!/bin/sh
#

usage="\
Usage: gtkdoc-mkman [--path=SEARCH_PATH] MODULE DRIVER_FILE"

# parse options, ignore unknown options for future extensions

searchpath=
while true; do
    case "X$1" in
        X--version) echo "@VERSION@"; exit 0;;
        X--help) echo "$usage"; exit 0;;
        X--path=*) searchpath=`echo $1 | sed s/.*=//`; shift;;
        X--*) shift;;
        X*) break;;
    esac
done

if test $# -ne 2; then
      echo "${usage}" 1>&2
      exit 1
fi

module=$1
shift
document=$1
shift

# FIXME: this is a hack to run uninstalled
if test "x$0" = "x@prefix@/bin/gtkdoc-mkhtml" ; then
      #echo "installed"
      # the first two are needed to resolve datadir
      prefix=@prefix@
      datarootdir=@datarootdir@
      gtkdocdir=@datadir@/gtk-doc/data
else
      #echo "uninstalled"
      gtkdocdir=`dirname $0`
fi

if head -n 1 $document | grep "<?xml" > /dev/null; then
  is_xml=true
else
  is_xml=false
fi

# see http://bugzilla.gnome.org/show_bug.cgi?id=467488
# 
#@XSLTPROC@ --nonet --xinclude \
#  --stringparam gtkdoc.bookname $module
#  --stringparam gtkdoc.version"@VERSION@" \
#  manpages/docbook.xsl $document || exit $?

if $is_xml; then
else
  for i in `cd sgml;ls *.sgml` do
    j=`echo $i | sed 's/.sgml/.man/'`
    echo ": converting " $i $j
    docbook-to-man sgml/$i > man/$j 2> man/$j.log
  done
fi

