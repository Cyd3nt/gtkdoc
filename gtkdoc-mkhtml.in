#!/bin/sh
#

usage="\
Usage: gtkdoc-mkhtml MODULE DRIVER_FILE"

#echo "args $0\n";

if test "x$1" = "x--version"; then
      echo "@VERSION@"
      exit 0
fi

if test $# -ne 2; then
      echo "${usage}" 1>&2
      exit 1
fi

module=$1
document=$2

# FIXME: this is a hack to run uninstalled
if test "x$0" = "x../../../gtkdoc-mkhtml" ; then
      # uninstalled
      gtkdocdir=`dirname $0`
else
      # installed
      prefix=@prefix@
      datarootdir=@datarootdir@
      gtkdocdir=@datadir@/gtk-doc/data
fi

if head -n 1 $document | grep "<?xml" > /dev/null; then
  is_xml=true
else
  is_xml=false
fi

# Delete the old index.sgml file, if it exists.
if test -f index.sgml; then
      rm -f index.sgml
fi

if $is_xml; then
  @XSLTPROC@ --nonet --xinclude \
      --stringparam gtkdoc.bookname $module \
      --stringparam gtkdoc.version "@VERSION@" \
      $gtkdocdir/gtk-doc.xsl $document || exit $?
else
  @JADE@ -t @SGML_FORMAT_TYPE@ -w no-idref -d $gtkdocdir/gtk-doc.dsl \
      -V "gtkdoc-bookname=$module" -V "gtkdoc-version=@VERSION@" \
      $gtkdocdir/gtk-doc.dcl $document || exit $?
fi

# copy navigation images and stylesheets to html directory ...
cp -f $gtkdocdir/*.png .
cp -f $gtkdocdir/*.css .


echo "timestamp" > ../html.stamp

